<%- include('partials/header') %>

<h1 class="page-title">Shopping Cart</h1>

<% if (cartItems.length === 0) { %>
  <div class="empty-state">
    <h3>Your cart is empty</h3>
    <p>Start shopping to add items to your cart!</p>
    <a href="/" class="btn btn-primary">Browse Products</a>
  </div>
<% } else { %>
  <div class="cart-container">
    <div class="cart-items">
      <% cartItems.forEach(item => { %>
        <div class="cart-item">
          <img src="<%= item.image_url %>" alt="<%= item.name %>" class="cart-item-image">
          <div class="cart-item-info">
            <h3><a href="/product/<%= item.id %>"><%= item.name %></a></h3>
            <p class="cart-item-price">$<%= parseFloat(item.price).toFixed(2) %> each</p>
          </div>
          <form action="/cart/update" method="POST" class="cart-item-qty">
            <input type="hidden" name="productId" value="<%= item.id %>">
            <input type="number" name="quantity" value="<%= item.quantity %>" min="1" max="<%= item.stock %>" onchange="this.form.submit()">
          </form>
          <div class="cart-item-subtotal">
            <p>$<%= item.subtotal %></p>
          </div>
          <form action="/cart/remove" method="POST">
            <input type="hidden" name="productId" value="<%= item.id %>">
            <button type="submit" class="btn btn-danger btn-sm">Remove</button>
          </form>
        </div>
      <% }) %>
    </div>
    <div class="cart-summary">
      <h3>Order Summary</h3>
      <div class="summary-row">
        <span>Subtotal</span>
        <span>$<%= total %></span>
      </div>
      <div class="summary-row">
        <span>Shipping</span>
        <span>Free</span>
      </div>
      <div class="summary-row total">
        <span>Total</span>
        <span>$<%= total %></span>
      </div>
      <a href="/orders/checkout" class="btn btn-primary btn-large btn-block">Proceed to Checkout</a>
      <a href="/" class="btn btn-outline btn-block">Continue Shopping</a>
    </div>
  </div>
<% } %>

<%- include('partials/footer') %>
