<%- include('../partials/admin-header') %>

<div class="admin-header">
  <h1>Customer Reviews</h1>
  <div class="admin-actions">
    <span class="text-muted"><%= totalReviews %> total reviews</span>
  </div>
</div>

<div class="admin-filters" style="margin-bottom: 20px;">
  <form action="/admin/reviews" method="GET" class="admin-search-form">
    <input type="text" name="search" placeholder="Search by product or customer..." value="<%= search %>" class="form-control">
    <select name="rating" class="form-control" style="max-width: 150px;">
      <option value="">All Ratings</option>
      <% for (let i = 5; i >= 1; i--) { %>
        <option value="<%= i %>" <%= filterRating == i ? 'selected' : '' %>><%= i %> Star<%= i > 1 ? 's' : '' %></option>
      <% } %>
    </select>
    <button type="submit" class="btn btn-primary">Filter</button>
    <% if (search || filterRating) { %>
      <a href="/admin/reviews" class="btn btn-outline">Clear</a>
    <% } %>
  </form>
</div>

<% if (reviews.length === 0) { %>
  <div class="empty-state">
    <h3>No reviews found</h3>
    <p>No customer reviews match your search criteria.</p>
  </div>
<% } else { %>
  <div class="table-responsive">
    <table class="admin-table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Customer</th>
          <th>Rating</th>
          <th>Review</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% reviews.forEach(review => { %>
          <tr>
            <td>
              <a href="/product/<%= review.product_id %>" target="_blank" style="color: #60a5fa;"><%= review.product_name %></a>
            </td>
            <td>
              <a href="/admin/customers/<%= review.customer_id %>" style="color: #60a5fa;"><%= review.customer_name %></a>
            </td>
            <td>
              <div class="stars-display" style="font-size: 14px;">
                <% for (let i = 1; i <= 5; i++) { %>
                  <span class="star <%= i <= review.rating ? 'filled' : '' %>">&#9733;</span>
                <% } %>
              </div>
            </td>
            <td class="review-text-cell">
              <%= review.review_text ? (review.review_text.length > 80 ? review.review_text.substring(0, 80) + '...' : review.review_text) : '(No text)' %>
            </td>
            <td><%= new Date(review.created_at).toLocaleDateString() %></td>
            <td>
              <form action="/admin/reviews/delete/<%= review.id %>" method="POST" style="display:inline" onsubmit="return confirm('Delete this review?')">
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <% if (totalPages > 1) { %>
    <div class="pagination">
      <% if (page > 1) { %>
        <a href="/admin/reviews?page=<%= page - 1 %>&search=<%= search %>&rating=<%= filterRating %>" class="btn btn-sm btn-outline">&laquo; Prev</a>
      <% } %>
      <span class="page-info">Page <%= page %> of <%= totalPages %></span>
      <% if (page < totalPages) { %>
        <a href="/admin/reviews?page=<%= page + 1 %>&search=<%= search %>&rating=<%= filterRating %>" class="btn btn-sm btn-outline">Next &raquo;</a>
      <% } %>
    </div>
  <% } %>
<% } %>

<%- include('../partials/admin-footer') %>
