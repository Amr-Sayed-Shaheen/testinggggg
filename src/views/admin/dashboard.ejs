<%- include('../partials/admin-header') %>

<div class="admin-header">
  <h1>Admin Dashboard</h1>
  <div class="admin-actions">
    <% if (isSuperAdmin || permissions.includes('manage_products')) { %>
      <a href="/admin/products/new" class="btn btn-primary">Add Product</a>
    <% } %>
    <% if (isSuperAdmin || permissions.includes('manage_categories')) { %>
      <a href="/admin/categories" class="btn btn-outline">Categories</a>
    <% } %>
    <% if (isSuperAdmin || permissions.includes('manage_roles')) { %>
      <a href="/admin/roles" class="btn btn-outline">Roles</a>
    <% } %>
    <% if (isSuperAdmin || permissions.includes('manage_users')) { %>
      <a href="/admin/users" class="btn btn-outline">Users</a>
    <% } %>
    <% if (isSuperAdmin || permissions.includes('manage_customers')) { %>
      <a href="/admin/customers" class="btn btn-outline">Customers</a>
    <% } %>
  </div>
</div>

<div class="admin-user-info">
  Logged in as <strong><%= adminUsername %></strong>
  <span class="status-badge status-processing"><%= roleName || 'No Role' %></span>
</div>

<div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
  <div class="stat-card">
    <h3><%= stats.product_count %></h3>
    <p>Products</p>
  </div>
  <div class="stat-card">
    <h3><%= stats.order_count %></h3>
    <p>Orders</p>
  </div>
  <div class="stat-card">
    <h3>$<%= parseFloat(stats.total_revenue).toFixed(2) %></h3>
    <p>Revenue</p>
  </div>
  <div class="stat-card">
    <h3><%= stats.customer_count %></h3>
    <p>Customers</p>
  </div>
</div>

<div class="admin-sections">
  <% if (isSuperAdmin || permissions.includes('view_orders')) { %>
  <section class="admin-section">
    <h2>Recent Orders</h2>
    <% if (orders.length === 0) { %>
      <p class="text-muted">No orders yet.</p>
    <% } else { %>
      <div class="table-responsive">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Order #</th>
              <th>Customer</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% orders.forEach(order => { %>
              <tr>
                <td>#<%= order.id %></td>
                <td><%= order.customer_name %></td>
                <td>$<%= parseFloat(order.total).toFixed(2) %></td>
                <td><span class="status-badge status-<%= order.status %>"><%= order.status %></span></td>
                <td><%= new Date(order.created_at).toLocaleDateString() %></td>
                <td class="actions-cell">
                  <a href="/admin/orders/<%= order.id %>" class="btn btn-sm btn-outline">View</a>
                  <% if (isSuperAdmin || permissions.includes('manage_orders')) { %>
                    <form action="/admin/orders/delete/<%= order.id %>" method="POST" style="display:inline" onsubmit="return confirm('Delete this order?')">
                      <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>
                  <% } %>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </section>
  <% } %>

  <% if (isSuperAdmin || permissions.includes('manage_products')) { %>
  <section class="admin-section">
    <h2>All Products</h2>
    <div class="table-responsive">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Category</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% products.forEach(product => { %>
            <tr>
              <td><img src="<%= product.image_url %>" alt="" class="table-thumb"></td>
              <td><%= product.name %></td>
              <td><%= product.category_name || 'None' %></td>
              <td>$<%= parseFloat(product.price).toFixed(2) %></td>
              <td><span class="<%= product.stock <= 5 ? 'text-danger' : '' %>"><%= product.stock %></span></td>
              <td class="actions-cell">
                <a href="/admin/products/edit/<%= product.id %>" class="btn btn-sm btn-outline">Edit</a>
                <form action="/admin/products/delete/<%= product.id %>" method="POST" style="display:inline" onsubmit="return confirm('Delete this product?')">
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% if (totalPages > 1) { %>
      <div class="pagination">
        <% if (page > 1) { %>
          <a href="/admin?page=<%= page - 1 %>" class="btn btn-outline btn-sm">&laquo; Previous</a>
        <% } %>
        <div class="page-numbers">
          <% for (let i = 1; i <= totalPages; i++) { %>
            <a href="/admin?page=<%= i %>" class="page-num <%= i === page ? 'active' : '' %>"><%= i %></a>
          <% } %>
        </div>
        <% if (page < totalPages) { %>
          <a href="/admin?page=<%= page + 1 %>" class="btn btn-outline btn-sm">Next &raquo;</a>
        <% } %>
      </div>
    <% } %>
  </section>
  <% } %>
</div>

<%- include('../partials/admin-footer') %>
