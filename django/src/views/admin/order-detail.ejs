<%- include('../partials/admin-header') %>

<div class="breadcrumb">
  <a href="/admin">Dashboard</a> &raquo;
  <span>Order #<%= order.id %></span>
</div>

<div class="order-detail-page">
  <div class="order-header">
    <h1>Order #<%= order.id %></h1>
    <span class="status-badge status-<%= order.status %>"><%= order.status %></span>
  </div>

  <div class="order-info-grid">
    <div class="info-card">
      <h3>Customer</h3>
      <p><strong><%= order.customer_name %></strong></p>
      <p><%= order.customer_email %></p>
    </div>
    <div class="info-card">
      <h3>Shipping Address</h3>
      <p><%= order.customer_address %></p>
    </div>
    <div class="info-card">
      <h3>Order Date</h3>
      <p><%= new Date(order.created_at).toLocaleString() %></p>
    </div>
  </div>

  <h3>Items</h3>
  <table class="admin-table">
    <thead>
      <tr>
        <th>Product</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Subtotal</th>
      </tr>
    </thead>
    <tbody>
      <% items.forEach(item => { %>
        <tr>
          <td><%= item.product_name %></td>
          <td><%= item.quantity %></td>
          <td>$<%= parseFloat(item.price).toFixed(2) %></td>
          <td>$<%= (parseFloat(item.price) * item.quantity).toFixed(2) %></td>
        </tr>
      <% }) %>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="3"><strong>Total</strong></td>
        <td><strong>$<%= parseFloat(order.total).toFixed(2) %></strong></td>
      </tr>
    </tfoot>
  </table>

  <div class="status-update">
    <h3>Update Status</h3>
    <form action="/admin/orders/<%= order.id %>/status" method="POST" class="inline-form">
      <select name="status">
        <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Pending</option>
        <option value="processing" <%= order.status === 'processing' ? 'selected' : '' %>>Processing</option>
        <option value="shipped" <%= order.status === 'shipped' ? 'selected' : '' %>>Shipped</option>
        <option value="delivered" <%= order.status === 'delivered' ? 'selected' : '' %>>Delivered</option>
        <option value="cancelled" <%= order.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
      </select>
      <button type="submit" class="btn btn-primary">Update</button>
    </form>
  </div>

  <div class="order-actions" style="margin-top: 1.5rem; display: flex; gap: 1rem; align-items: center;">
    <a href="/admin" class="btn btn-outline">Back to Dashboard</a>
    <form action="/admin/orders/delete/<%= order.id %>" method="POST" style="display:inline" onsubmit="return confirm('Delete this order permanently?')">
      <button type="submit" class="btn btn-danger">Delete Order</button>
    </form>
  </div>
</div>

<%- include('../partials/admin-footer') %>
