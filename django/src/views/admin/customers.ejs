<%- include('../partials/admin-header') %>

<div class="admin-header">
  <h1>Registered Customers (<%= totalCustomers %>)</h1>
  <a href="/admin" class="btn btn-outline">Back to Dashboard</a>
</div>

<div class="admin-user-info">
  Logged in as <strong><%= adminUsername %></strong>
  <span class="status-badge status-processing"><%= roleName || 'No Role' %></span>
</div>

<form action="/admin/customers" method="GET" class="inline-form add-category-form">
  <input type="text" name="search" placeholder="Search by name or email..." value="<%= search %>">
  <button type="submit" class="btn btn-primary btn-sm">Search</button>
  <% if (search) { %>
    <a href="/admin/customers" class="btn btn-outline btn-sm">Clear</a>
  <% } %>
</form>

<% if (customers.length === 0) { %>
  <p class="text-muted" style="padding: 24px 0;"><%= search ? 'No customers found matching your search.' : 'No registered customers yet.' %></p>
<% } else { %>
  <div class="table-responsive">
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Email</th>
          <th>Orders</th>
          <th>Total Spent</th>
          <th>Registered</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% customers.forEach(customer => { %>
          <tr>
            <td>#<%= customer.id %></td>
            <td><%= customer.name %></td>
            <td><%= customer.email %></td>
            <td><%= customer.order_count %></td>
            <td>$<%= parseFloat(customer.total_spent).toFixed(2) %></td>
            <td><%= new Date(customer.created_at).toLocaleDateString() %></td>
            <td class="actions-cell">
              <a href="/admin/customers/<%= customer.id %>" class="btn btn-sm btn-outline">View</a>
              <form action="/admin/customers/delete/<%= customer.id %>" method="POST" style="display:inline" onsubmit="return confirm('Delete this customer? Their orders will be kept but unlinked.')">
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <% if (totalPages > 1) { %>
    <div class="pagination">
      <% if (page > 1) { %>
        <a href="/admin/customers?page=<%= page - 1 %><%= search ? '&search=' + encodeURIComponent(search) : '' %>" class="btn btn-outline btn-sm">&laquo; Previous</a>
      <% } %>
      <div class="page-numbers">
        <% for (let i = 1; i <= totalPages; i++) { %>
          <a href="/admin/customers?page=<%= i %><%= search ? '&search=' + encodeURIComponent(search) : '' %>" class="page-num <%= i === page ? 'active' : '' %>"><%= i %></a>
        <% } %>
      </div>
      <% if (page < totalPages) { %>
        <a href="/admin/customers?page=<%= page + 1 %><%= search ? '&search=' + encodeURIComponent(search) : '' %>" class="btn btn-outline btn-sm">Next &raquo;</a>
      <% } %>
    </div>
  <% } %>
<% } %>

<%- include('../partials/admin-footer') %>
