<%- include('partials/header') %>

<div class="page-title">
  <h1>Shop All Products</h1>
</div>

<div class="shop-layout">
  <aside class="sidebar">
    <h3>Categories</h3>
    <ul class="category-list">
      <li><a href="/shop" class="<%= !currentCategory ? 'active' : '' %>">All Products</a></li>
      <% categories.forEach(cat => { %>
        <li><a href="/shop?category=<%= cat.slug %>" class="<%= currentCategory === cat.slug ? 'active' : '' %>"><%= cat.name %></a></li>
      <% }) %>
    </ul>

    <form class="search-form" action="/shop" method="GET">
      <input type="text" name="search" placeholder="Search products..." value="<%= search %>">
      <button type="submit">Search</button>
    </form>
  </aside>

  <div class="product-grid">
    <% if (products.length === 0) { %>
      <div class="empty-state">
        <h3>No products found</h3>
        <p>Try a different search or category.</p>
      </div>
    <% } %>
    <% products.forEach(product => { %>
      <div class="product-card">
        <a href="/product/<%= product.id %>">
          <div class="product-image">
            <img src="<%= product.image_url %>" alt="<%= product.name %>">
          </div>
          <div class="product-info">
            <span class="product-category"><%= product.category_name || 'Uncategorized' %></span>
            <h3><%= product.name %></h3>
            <p class="product-price">$<%= parseFloat(product.price).toFixed(2) %></p>
            <% if (product.stock <= 0) { %>
              <span class="out-of-stock">Out of Stock</span>
            <% } %>
          </div>
        </a>
        <% if (product.stock > 0) { %>
          <form action="/cart/add" method="POST">
            <input type="hidden" name="productId" value="<%= product.id %>">
            <input type="hidden" name="quantity" value="1">
            <button type="submit" class="btn btn-primary add-to-cart">Add to Cart</button>
          </form>
        <% } %>
      </div>
    <% }) %>
  </div>
</div>

<% if (totalPages > 1) { %>
  <div class="pagination">
    <% if (page > 1) { %>
      <a href="/shop?page=<%= page - 1 %><%= currentCategory ? '&category=' + currentCategory : '' %><%= search ? '&search=' + encodeURIComponent(search) : '' %>" class="btn btn-outline btn-sm">&laquo; Previous</a>
    <% } %>
    <div class="page-numbers">
      <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="/shop?page=<%= i %><%= currentCategory ? '&category=' + currentCategory : '' %><%= search ? '&search=' + encodeURIComponent(search) : '' %>" class="page-num <%= i === page ? 'active' : '' %>"><%= i %></a>
      <% } %>
    </div>
    <% if (page < totalPages) { %>
      <a href="/shop?page=<%= page + 1 %><%= currentCategory ? '&category=' + currentCategory : '' %><%= search ? '&search=' + encodeURIComponent(search) : '' %>" class="btn btn-outline btn-sm">Next &raquo;</a>
    <% } %>
  </div>
<% } %>

<%- include('partials/footer') %>
